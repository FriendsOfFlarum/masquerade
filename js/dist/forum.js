module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=flarum.core.compat.Model},function(e,t,n){"use strict";function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}n.d(t,"a",function(){return r})},function(e,t){e.exports=flarum.core.compat["helpers/icon"]},function(e,t){e.exports=flarum.core.compat.extend},function(e,t){e.exports=flarum.core.compat["components/Button"]},function(e,t){e.exports=flarum.core.compat.app},function(e,t){e.exports=flarum.core.compat["utils/mixin"]},function(e,t){e.exports=flarum.core.compat["components/UserPage"]},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),i=n(0),o=n.n(i),a=n(6),s=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.apiEndpoint=function(){return"/masquerade/fields"+(this.exists?"/"+this.data.id:"")},t}(n.n(a)()(o.a,{name:o.a.attribute("name"),description:o.a.attribute("description"),type:o.a.attribute("type"),validation:o.a.attribute("validation"),required:o.a.attribute("required"),prefix:o.a.attribute("prefix"),icon:o.a.attribute("icon"),sort:o.a.attribute("sort"),deleted_at:o.a.attribute("deleted_at",o.a.transformDate),answer:o.a.hasOne("answer"),on_bio:o.a.attribute("on_bio")}))},function(e,t){e.exports=flarum.core.compat["components/Select"]},,,,function(e,t){e.exports=flarum.core.compat["models/User"]},function(e,t){e.exports=flarum.core.compat["components/LinkButton"]},function(e,t){e.exports=flarum.core.compat["components/UserCard"]},,,,function(e,t,n){"use strict";n.r(t);var r=n(3),i=n(5),o=n.n(i),a=n(13),s=n.n(a),u=n(8),l=n(1),p=n(0),f=n.n(p),d=n(6),c=function(e){function t(){return e.apply(this,arguments)||this}return Object(l.a)(t,e),t.prototype.apiEndpoint=function(){return"/masquerade/configure"+(this.exists?"/"+this.data.id:"")},t}(n.n(d)()(f.a,{content:f.a.attribute("content"),field:f.a.hasOne("field"),userId:f.a.attribute("user_id")})),h=n(7),v=n.n(h),b=n(2),y=n.n(b),q=function(){function e(e){var t=e.field,n=e.set,r=e.value;this.field=t,this.set=n,this.value=r}var t=e.prototype;return t.readAttribute=function(e,t){return"function"==typeof e[t]?e[t]():e[t]},t.validationRules=function(){return this.readAttribute(this.field,"validation").split("|")},t.validationRule=function(e){var t=null;return this.validationRules().forEach(function(n){var r=n.split(":",2);r[0]===e&&(t=r[1])}),t},t.editorField=function(){return m("fieldset.Field",[m("legend",[this.field.icon()?[y()(this.field.icon())," "]:null,this.field.name(),this.field.required()?" *":null]),m(".FormField",[this.field.prefix()?m(".prefix",this.field.prefix()):null,this.editorInput(),this.field.description()?m(".helpText",this.field.description()):null])])},t.editorInput=function(){return m("input",this.editorInputProps())},t.editorInputProps=function(){return{className:"FormControl",oninput:m.withAttr("value",this.set),value:this.value(),required:this.field.required()}},t.answerField=function(){var e=this.readAttribute(this.field,"icon");return m(".Masquerade-Bio-Set",[m("span.Masquerade-Bio-Field",[e?[y()(e)," "]:null,this.readAttribute(this.field,"name")+": "]),m("span.Masquerade-Bio-Answer",this.answerContent())])},t.answerContent=function(){return this.value()},e.isNoOptionSelectedValue=function(e){return null===e||""===e},e}(),w=function(e){function t(){return e.apply(this,arguments)||this}Object(l.a)(t,e);var n=t.prototype;return n.editorInput=function(){var e=this;return this.options().map(function(t){return m("div",m("label",[m("input[type=radio]",{checked:t.selected(e.value()),onclick:function(){e.set(t.key)}})," "+t.label]))})},n.options=function(){var e=[];return this.readAttribute(this.field,"required")||e.push({selected:function(e){return q.isNoOptionSelectedValue(e)},key:null,label:app.translator.trans("fof-masquerade.forum.fields.select.none-optional")}),e.push({selected:function(e){return-1!==["true","1",1,!0,"yes"].indexOf(e)},key:"true",label:app.translator.trans("fof-masquerade.forum.fields.boolean.yes")}),e.push({selected:function(e){return-1!==["false","0",0,!1,"no"].indexOf(e)},key:"false",label:app.translator.trans("fof-masquerade.forum.fields.boolean.no")}),q.isNoOptionSelectedValue(this.value())||-1!==["true","1",1,!0,"yes","false","0",0,!1,"no"].indexOf(this.value())||e.push({selected:function(){return!0},key:this.value(),label:"(invalid) "+this.value()}),e},n.answerContent=function(){return q.isNoOptionSelectedValue(this.value())?"":-1!==[1,"1",!0,"true","yes"].indexOf(this.value())?[y()("far fa-check-square")," ",app.translator.trans("fof-masquerade.forum.fields.boolean.yes")]:[y()("far fa-square")," ",app.translator.trans("fof-masquerade.forum.fields.boolean.no")]},t}(q),x=n(4),O=n.n(x),_=function(e){function t(){return e.apply(this,arguments)||this}Object(l.a)(t,e);var n=t.prototype;return n.editorInputProps=function(){var t=e.prototype.editorInputProps.call(this);return t.type="email",t.placeholder="you@example.com",t},n.answerContent=function(){var e=this,t=this.value();if(!t)return null;var n=t.split(/@|\./).map(function(e){return e.replace(/(.{2})./g,"$1*")}).join("*");return O.a.component({onclick:function(){return e.mailTo()},className:"Button Button--text",icon:"far fa-envelope",children:n})},n.mailTo=function(){window.location="mailto:"+this.value()},t}(q),g=n(9),F=n.n(g),P=function(e){function t(){return e.apply(this,arguments)||this}Object(l.a)(t,e);var n=t.prototype;return n.editorInput=function(){var e=this;return F.a.component({onchange:function(t){"fof_masquerade_no_option_selected"===t&&(t=null),e.set(t)},value:q.isNoOptionSelectedValue(this.value())?"fof_masquerade_no_option_selected":this.value(),options:this.options()})},n.options=function(){var e={};this.readAttribute(this.field,"required")?q.isNoOptionSelectedValue(this.value())&&(e.fof_masquerade_no_option_selected=app.translator.trans("fof-masquerade.forum.fields.select.none-required")):e.fof_masquerade_no_option_selected=app.translator.trans("fof-masquerade.forum.fields.select.none-optional");var t=this.validationRule("in");return t&&t.split(",").forEach(function(t){e[t]=t}),q.isNoOptionSelectedValue(this.value())||void 0!==e[this.value()]||(e[this.value()]="(invalid) "+this.value()),e},t}(q),j=function(e){function t(){return e.apply(this,arguments)||this}Object(l.a)(t,e);var n=t.prototype;return n.editorInputProps=function(){var t=e.prototype.editorInputProps.call(this);return t.type="url",t.placeholder="https://example.com",t},n.answerContent=function(){var e=this,t=this.value();return t?O.a.component({onclick:function(){return e.to()},className:"Button Button--text",icon:"fas fa-link",children:t.replace(/^https?:\/\//,"")}):null},n.to=function(){window.open().location=this.value()},t}(q),M=function(){function e(){}return e.typeForField=function(e){var t=e.field,n=e.set,r=e.value,i=q,o=this.identify(t);return o&&(i=this.types()[o]),new i({field:t,set:n,value:r})},e.fieldAttribute=function(e,t){return"function"==typeof e[t]?e[t]():e[t]},e.types=function(){return{boolean:w,email:_,select:P,url:j}},e.identify=function(e){var t=this,n=this.fieldAttribute(e,"validation").split(","),r=null,i=this.fieldAttribute(e,"type");return void 0!==this.types()[i]?i:(n.forEach(function(e){e=e.trim(),void 0!==t.types()[e]&&(r=e)}),r)},e}(),N=function(e){function t(){return e.apply(this,arguments)||this}Object(l.a)(t,e);var n=t.prototype;return n.init=function(){e.prototype.init.call(this),this.loading=!0,this.fields=[],this.answers={},this.loadUser(m.route.param("username"))},n.content=function(){var e=this;return m("div",{className:"Masquerade-Bio"},[m("div",{className:"Fields"},this.fields.sort(function(e,t){return e.sort()-t.sort()}).map(function(t){return e.answers[t.id()]=t.answer()&&t.answer().userId()==e.user.id()?t.answer().content():null,e.field(t)}))])},n.field=function(e){return M.typeForField({field:e,value:m.prop(this.answers[e.id()])}).answerField()},n.load=function(e){app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/masquerade/profile/"+e.id()}).then(this.parseResponse.bind(this))},n.show=function(t){this.load(t),e.prototype.show.call(this,t)},n.parseResponse=function(e){this.answers={},this.fields=app.store.pushPayload(e),this.loading=!1,m.redraw()},t}(v.a),S=function(e){function t(){return e.apply(this,arguments)||this}Object(l.a)(t,e);var n=t.prototype;return n.init=function(){e.prototype.init.call(this),this.loading=!0,this.loadUser(app.session.user.username()),this.enforceProfileCompletion=app.forum.attribute("masquerade.force-profile-completion")||!1,this.profileCompleted=app.forum.attribute("masquerade.profile-completed")||!1,this.fields=[],this.answers={},this.load()},n.content=function(){var e=this;return m("form",{className:"ProfileConfigurePane",onsubmit:this.update.bind(this)},[this.enforceProfileCompletion&&!this.profileCompleted?m("div",{className:"Alert Alert--Error"},app.translator.trans("fof-masquerade.forum.alerts.profile-completion-required")):"",m("div",{className:"Fields"},this.fields.sort(function(e,t){return e.sort()-t.sort()}).map(function(t){return e.answers.hasOwnProperty(t.id())||(e.answers[t.id()]=t.answer()?m.prop(t.answer().content()):m.prop("")),e.field(t)})),O.a.component({type:"submit",className:"Button Button--primary",children:app.translator.trans("fof-masquerade.forum.buttons.save-profile"),loading:this.loading})])},n.field=function(e){return M.typeForField({field:e,set:this.set.bind(this,e),value:this.answers[e.id()]}).editorField()},n.load=function(){app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/masquerade/configure"}).then(this.parseResponse.bind(this))},n.set=function(e,t){this.answers.hasOwnProperty(e.id())?this.answers[e.id()](t):this.answers[e.id()]=m.prop(t)},n.update=function(e){e.preventDefault(),this.loading=!0;var t=this.answers;app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/masquerade/configure",data:t}).then(this.parseResponse.bind(this))},n.parseResponse=function(e){this.fields=app.store.pushPayload(e),this.loading=!1,m.redraw()},t}(v.a),I=n(14),A=n.n(I),k=function(){app.routes["fof-masquerade-view-profile"]={path:"/masquerade/:username",component:N.component()},app.routes["fof-masquerade-configure-profile"]={path:"/masquerade/configure",component:S.component()},Object(r.extend)(v.a.prototype,"navItems",function(e){if(console.log(app.forum.attribute("canViewMasquerade"),app.forum.attribute("canHaveMasquerade")),app.forum.attribute("canViewMasquerade")||app.forum.attribute("canHaveMasquerade")){var t=this.user,n=app.forum.attribute("canHaveMasquerade")&&app.session.user===t?app.route("fof-masquerade-configure-profile"):app.route("fof-masquerade-view-profile",{username:t.username()});e.add("masquerade",A.a.component({href:n,children:app.translator.trans("fof-masquerade.forum.buttons.view-profile"),icon:"far fa-id-card"}),200)}})},B=n(15),C=n.n(B),V=function(){Object(r.extend)(C.a.prototype,"infoItems",function(e){var t=app.forum.attribute("canViewMasquerade")&&this.props.user.bioFields()||[];e.add("masquerade-bio",m("div",t.map(function(e){var t=e.attribute("field");return M.typeForField({field:t,value:function(){return e.content()}}).answerField()})))})};o.a.initializers.add("fof-masquerade",function(e){e.store.models["masquerade-field"]=u.a,e.store.models["masquerade-answer"]=c,s.a.prototype.bioFields=f.a.hasMany("bioFields"),k(),V()})}]);
//# sourceMappingURL=forum.js.map