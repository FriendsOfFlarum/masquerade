module.exports=function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=20)}([function(t,e){t.exports=flarum.core.compat.Model},function(t,e,a){"use strict";function n(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}a.d(e,"a",function(){return n})},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},,function(t,e,a){"use strict";a.d(e,"a",function(){return s});var n=a(1),i=a(0),o=a.n(i),r=a(6),s=function(t){function e(){return t.apply(this,arguments)||this}return Object(n.a)(e,t),e.prototype.apiEndpoint=function(){return"/masquerade/fields"+(this.exists?"/"+this.data.id:"")},e}(a.n(r)()(o.a,{name:o.a.attribute("name"),description:o.a.attribute("description"),type:o.a.attribute("type"),validation:o.a.attribute("validation"),required:o.a.attribute("required"),prefix:o.a.attribute("prefix"),icon:o.a.attribute("icon"),sort:o.a.attribute("sort"),deleted_at:o.a.attribute("deleted_at",o.a.transformDate),answer:o.a.hasOne("answer"),on_bio:o.a.attribute("on_bio")}))},function(t,e){t.exports=flarum.core.compat["components/Select"]},function(t,e){t.exports=flarum.core.compat["components/Switch"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/PermissionGrid"]},,,,function(t,e){t.exports=flarum.core.compat["components/AdminNav"]},function(t,e){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,e){t.exports=flarum.core.compat["utils/saveSettings"]},,function(t,e,a){"use strict";a.r(e);var n=a(3),i=a(5),o=a.n(i),r=a(12),s=a.n(r),u=a(8),p=a(16),l=a.n(p),d=a(17),f=a.n(d),c=a(1),h=a(11),b=a.n(h),v=a(9),g=a.n(v),q=a(10),x=a.n(q),y=a(4),w=a.n(y),F=a(18),O=a.n(F),E=a(2),N=a.n(E),S=function(t){function e(){return t.apply(this,arguments)||this}Object(c.a)(e,t);var a=e.prototype;return a.init=function(){this.newOption=m.prop("")},a.view=function(){var t=this;return m("li",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.options")),m("table",m("tbody",this.options().map(function(e,a){return m("tr",[m("td",m("input[type=text].FormControl",{oninput:m.withAttr("value",function(e){t.updateOption(a,e)}),value:e})),m("td",m("button.Button",{onclick:function(){t.moveOption(a,-1)}},N()("fas fa-chevron-up"))),m("td",m("button.Button",{onclick:function(){t.moveOption(a,1)}},N()("fas fa-chevron-down"))),m("td",m("button.Button.Button--danger",{onclick:function(){t.deleteOption(a)}},N()("fas fa-close")))])}))),m(".helpText",o.a.translator.trans("fof-masquerade.admin.fields.option-coma-warning")),m("table",m("tbody"),m("tr",[m("td",m("input[type=text].FormControl",{onchange:m.withAttr("value",this.newOption),value:this.newOption(),placeholder:o.a.translator.trans("fof-masquerade.admin.fields.option-new")})),m("td",m("button.Button.Button--primary",{onclick:function(){t.addOption()}},N()("fas fa-plus")))]))])},a.updateRules=function(t){this.props.onchange("in:"+t.join(","))},a.options=function(){var t=this.props.value.split("|"),e=[];return t.forEach(function(t){var a=t.split(":",2);"in"===a[0]&&(e=a[1].split(","))}),e},a.updateOption=function(t,e){var a=this.options();a[t]=e,this.updateRules(a)},a.moveOption=function(t,e){var a=this.options(),n=t+e;if(!(n<0||n>a.length-1)){var i=a.splice(t,1);a.splice(n,0,i[0]),this.updateRules(a)}},a.deleteOption=function(t){var e=this.options();e.splice(t,1),this.updateRules(e)},a.addOption=function(){if(""!==this.newOption()){var t=this.options();t.push(this.newOption()),this.newOption(""),this.updateRules(t)}},e}(b.a),_=function(t){function e(){return t.apply(this,arguments)||this}Object(c.a)(e,t);var a=e.prototype;return a.init=function(){this.resetNew(),this.loading=!1,this.existing=[],this.loadExisting(),this.enforceProfileCompletion=m.prop(1==app.data.settings["masquerade.force-profile-completion"]),this.disableUserBio=m.prop(1==app.data.settings["masquerade.disable-user-bio"])},a.config=function(){var t=this;this.$(".Existing--Fields").sortable({cancel:""}).on("sortupdate",function(e,a){var n=t.$(".Existing--Fields > .Field").map(function(){return $(this).data("id")}).get();t.updateSort(n)})},a.view=function(){var t=this,e=[];return this.existing.sort(function(t,e){return t.sort()-e.sort()}).forEach(function(a){e.push(t.addField(a))}),m("div",{className:"ProfileConfigurePane"},[m("div",{className:"container"},[m("form",{className:"Configuration"},[m("label",""),[x.a.component({state:this.enforceProfileCompletion(),onchange:this.updateSetting.bind(this,this.enforceProfileCompletion,"masquerade.force-profile-completion"),children:app.translator.trans("fof-masquerade.admin.fields.force-user-to-completion")}),m("br")],m("label",""),[x.a.component({state:this.disableUserBio(),onchange:this.updateSetting.bind(this,this.disableUserBio,"masquerade.disable-user-bio"),children:app.translator.trans("fof-masquerade.admin.fields.disable-user-bio")}),m("br")]]),m("form",{className:"Existing--Fields"},e),m("form",{onsubmit:this.submitAddField.bind(this)},[this.addField(this.new)])])])},a.updateSetting=function(t,e,a){var n;O()(((n={})[e]=a,n)),t(a)},a.addField=function(t){var e=this,a=t.id();return m("fieldset",{className:"Field","data-id":t.id()},[m("legend",[a?m("div",{className:"ButtonGroup pull-right"},[w.a.component({className:"Button Button--icon Button--danger",icon:"fas fa-trash",onclick:this.deleteField.bind(this,t)})]):null,m("span",{className:"title",onclick:function(t){return e.toggleField(t)}},app.translator.trans("fof-masquerade.admin.fields."+(a?"edit":"add"),{field:t.name()}))]),m("ul",[m("li",[m("label",app.translator.trans("fof-masquerade.admin.fields.name")),m("input",{className:"FormControl",value:t.name(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"name",t))}),m("span",{className:"helpText"},app.translator.trans("fof-masquerade.admin.fields.name-help"))]),m("li",[m("label",app.translator.trans("fof-masquerade.admin.fields.description")),m("input",{className:"FormControl",value:t.description(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"description",t))}),m("span",{className:"helpText"},app.translator.trans("fof-masquerade.admin.fields.description-help"))]),m("li",[m("label",app.translator.trans("fof-masquerade.admin.fields.icon")),m("input",{className:"FormControl",value:t.icon(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"icon",t))}),m("span",{className:"helpText"},app.translator.trans("fof-masquerade.admin.fields.icon-help",{a:m("a",{href:"https://fontawesome.com/icons?m=free",target:"_blank"})}))]),m("li",[m("label",""),[x.a.component({state:t.on_bio(),onchange:this.updateExistingFieldInput.bind(this,"on_bio",t),children:app.translator.trans("fof-masquerade.admin.fields.on_bio")}),m("br")]]),m("li",[m("label",""),[x.a.component({state:t.required(),onchange:this.updateExistingFieldInput.bind(this,"required",t),children:app.translator.trans("fof-masquerade.admin.fields.required")}),m("br")]]),m("li",[m("label",app.translator.trans("fof-masquerade.admin.fields.type")),g.a.component({onchange:function(a){"null"===a&&(a=null),e.updateExistingFieldInput("type",t,a)},options:this.availableTypes(),value:t.type()})]),"select"===t.type()?S.component({onchange:function(a){e.updateExistingFieldInput("validation",t,a)},value:t.validation()}):null,null===t.type()?m("li",[m("label",app.translator.trans("fof-masquerade.admin.fields.validation")),m("input",{className:"FormControl",value:t.validation(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"validation",t))}),m("span",{className:"helpText"},app.translator.trans("fof-masquerade.admin.fields.validation-help",{a:m("a",{href:"https://laravel.com/docs/5.2/validation#available-validation-rules",target:"_blank"})}))]):null,m("li",{className:"ButtonGroup"},[w.a.component({type:"submit",className:"Button Button--primary",children:app.translator.trans("fof-masquerade.admin.buttons."+(a?"edit":"add")+"-field"),loading:this.loading,disabled:!this.readyToAdd(t),onclick:this.updateExistingField.bind(this,t)}),a?w.a.component({type:"submit",className:"Button Button--danger",children:app.translator.trans("fof-masquerade.admin.buttons.delete-field"),loading:this.loading,onclick:this.deleteField.bind(this,t)}):""])])])},a.updateExistingFieldInput=function(t,e,a){var n;e.id()?e.pushAttributes(((n={})[t]=a,n)):e[t](a)},a.updateSort=function(t){var e={sort:t};app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/masquerade/fields/order",data:e})},a.toggleField=function(t){$(t.target).parents(".Field").toggleClass("active")},a.deleteField=function(t){app.request({method:"DELETE",url:app.forum.attribute("apiUrl")+"/masquerade/fields/"+t.id()}).then(this.requestSuccess.bind(this))},a.submitAddField=function(t){t.preventDefault();var e=this.new;app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/masquerade/fields",data:e}).then(this.requestSuccess.bind(this)),this.resetNew(),m.redraw()},a.updateExistingField=function(t){if(t.id()){var e=t.data;app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/masquerade/fields/"+t.id(),data:e}).then(this.requestSuccess.bind(this))}},a.requestSuccess=function(t){var e=app.store.pushPayload(t);e instanceof Array||!e.deleted_at()||app.store.remove(e),this.existing=app.store.all("masquerade-field"),this.loading=!1,m.redraw()},a.loadExisting=function(){return this.loading=!0,app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/masquerade/fields"}).then(this.requestSuccess.bind(this))},a.resetNew=function(){this.new={id:m.prop(),name:m.prop(""),description:m.prop(""),prefix:m.prop(""),icon:m.prop(""),required:m.prop(!1),on_bio:m.prop(!1),type:m.prop(null),validation:m.prop("")}},a.readyToAdd=function(t){return!!t.name()},a.availableTypes=function(){return{url:app.translator.trans("fof-masquerade.admin.types.url"),email:app.translator.trans("fof-masquerade.admin.types.email"),boolean:app.translator.trans("fof-masquerade.admin.types.boolean"),select:app.translator.trans("fof-masquerade.admin.types.select"),null:app.translator.trans("fof-masquerade.admin.types.advanced")}},e}(b.a),B=function(){app.routes["fof-masquerade-configure-profile"]={path:"/fof/masquerade/configure",component:_.component()},app.extensionSettings["fof-masquerade"]=function(){return m.route(app.route("fof-masquerade-configure-profile"))},Object(n.extend)(l.a.prototype,"items",function(t){t.add("fof-masquerade-configure-profile",f.a.component({href:app.route("fof-masquerade-configure-profile"),icon:"far fa-id-card",children:"Masquerade",description:app.translator.trans("fof-masquerade.admin.menu.description")}))})};o.a.initializers.add("fof-masquerade",function(t){t.store.models["masquerade-field"]=u.a,Object(n.extend)(s.a.prototype,"viewItems",function(e){e.add("masquerade-view-profile",{icon:"far fa-id-card",label:t.translator.trans("fof-masquerade.admin.permissions.view-profile"),permission:"fof.masquerade.view-profile",allowGuest:!0})}),Object(n.extend)(s.a.prototype,"startItems",function(e){e.add("masquerade-have-profile",{icon:"far fa-id-card",label:t.translator.trans("fof-masquerade.admin.permissions.have-profile"),permission:"fof.masquerade.have-profile"})}),B()})}]);
//# sourceMappingURL=admin.js.map