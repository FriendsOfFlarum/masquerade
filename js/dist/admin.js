module.exports=function(t){var e={};function n(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e,n){"use strict";function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}n.d(e,"a",function(){return a})},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},,function(t,e,n){"use strict";n.d(e,"a",function(){return s});var a=n(2),i=n(1),o=n.n(i),r=n(6),s=function(t){function e(){return t.apply(this,arguments)||this}return Object(a.a)(e,t),e.prototype.apiEndpoint=function(){return"/masquerade/fields"+(this.exists?"/"+this.data.id:"")},e}(n.n(r)()(o.a,{name:o.a.attribute("name"),description:o.a.attribute("description"),type:o.a.attribute("type"),validation:o.a.attribute("validation"),required:o.a.attribute("required"),prefix:o.a.attribute("prefix"),icon:o.a.attribute("icon"),sort:o.a.attribute("sort"),deleted_at:o.a.attribute("deleted_at",o.a.transformDate),answer:o.a.hasOne("answer"),on_bio:o.a.attribute("on_bio")}))},function(t,e){t.exports=flarum.core.compat["components/Select"]},function(t,e){t.exports=flarum.core.compat["components/Switch"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/PermissionGrid"]},,,,function(t,e){t.exports=flarum.core.compat["components/AdminNav"]},function(t,e){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,e){t.exports=flarum.core.compat["utils/saveSettings"]},,function(t,e,n){"use strict";n.r(e);var a=n(4),i=n(0),o=n.n(i),r=n(12),s=n.n(r),u=n(8),d=n(16),l=n.n(d),p=n(17),f=n.n(p),c=n(2),h=n(3),b=n.n(h),g=n(11),v=n.n(g),q=n(9),x=n.n(q),y=n(10),F=n.n(y),w=n(5),O=n.n(w),S=n(18),_=n.n(S),B=function(t){function e(){return t.apply(this,arguments)||this}Object(c.a)(e,t);var n=e.prototype;return n.init=function(){this.newOption=m.prop("")},n.view=function(){var t=this;return m(".Form-group",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.options")),m("table",m("tbody",this.options().map(function(e,n){return m("tr",[m("td",m("input[type=text].FormControl",{oninput:m.withAttr("value",function(e){t.updateOption(n,e)}),value:e})),m("td",m("button.Button",{onclick:function(){t.moveOption(n,-1)}},b()("fas fa-chevron-up"))),m("td",m("button.Button",{onclick:function(){t.moveOption(n,1)}},b()("fas fa-chevron-down"))),m("td",m("button.Button.Button--danger",{onclick:function(){t.deleteOption(n)}},b()("fas fa-close")))])}))),m(".helpText",o.a.translator.trans("fof-masquerade.admin.fields.option-coma-warning")),m("table",m("tbody"),m("tr",[m("td",m("input[type=text].FormControl",{onchange:m.withAttr("value",this.newOption),value:this.newOption(),placeholder:o.a.translator.trans("fof-masquerade.admin.fields.option-new")})),m("td",m("button.Button.Button--primary",{onclick:function(){t.addOption()}},b()("fas fa-plus")))]))])},n.updateRules=function(t){this.props.onchange("in:"+t.join(","))},n.options=function(){var t=this.props.value.split("|"),e=[];return t.forEach(function(t){var n=t.split(":",2);"in"===n[0]&&(e=n[1].split(","))}),e},n.updateOption=function(t,e){var n=this.options();n[t]=e,this.updateRules(n)},n.moveOption=function(t,e){var n=this.options(),a=t+e;if(!(a<0||a>n.length-1)){var i=n.splice(t,1);n.splice(a,0,i[0]),this.updateRules(n)}},n.deleteOption=function(t){var e=this.options();e.splice(t,1),this.updateRules(e)},n.addOption=function(){if(""!==this.newOption()){var t=this.options();t.push(this.newOption()),this.newOption(""),this.updateRules(t)}},e}(v.a),E=function(t){function e(){return t.apply(this,arguments)||this}Object(c.a)(e,t);var n=e.prototype;return n.init=function(){this.resetNew(),this.loading=!1,this.existing=[],this.loadExisting(),this.enforceProfileCompletion=m.prop(1==o.a.data.settings["masquerade.force-profile-completion"]),this.disableUserBio=m.prop(1==o.a.data.settings["masquerade.disable-user-bio"])},n.config=function(){var t=this;this.$(".js-sortable-fields").sortable({cancel:""}).on("sortupdate",function(e,n){var a=t.$(".js-sortable-fields > .Field").map(function(){return $(this).data("id")}).get();t.updateSort(a)})},n.view=function(){var t=this;return m(".ProfileConfigurePane",m(".container",[m("h1",o.a.translator.trans("fof-masquerade.admin.title")),m("h2",o.a.translator.trans("fof-masquerade.admin.general-options")),m("form",[m(".Form-group",F.a.component({state:this.enforceProfileCompletion(),onchange:this.updateSetting.bind(this,this.enforceProfileCompletion,"masquerade.force-profile-completion"),children:o.a.translator.trans("fof-masquerade.admin.fields.force-user-to-completion")})),m(".Form-group",F.a.component({state:this.disableUserBio(),onchange:this.updateSetting.bind(this,this.disableUserBio,"masquerade.disable-user-bio"),children:o.a.translator.trans("fof-masquerade.admin.fields.disable-user-bio")}))]),m("h2",o.a.translator.trans("fof-masquerade.admin.fields.title")),m("form.js-sortable-fields",this.existing.map(function(e){return t.addField(e)})),m("form",{onsubmit:this.submitAddField.bind(this)},[this.addField(this.new)])]))},n.updateSetting=function(t,e,n){var a;_()(((a={})[e]=n,a)),t(n)},n.addField=function(t){var e=this,n=t.id();return m("fieldset.Field",{"data-id":t.id(),key:t.id()},[m("legend",[n?[O.a.component({className:"Button Button--icon Button--danger",icon:"fas fa-trash",onclick:this.deleteField.bind(this,t)})," "]:null,m("span.Field-toggle",{onclick:function(t){return e.toggleField(t)}},[o.a.translator.trans("fof-masquerade.admin.fields."+(n?"edit":"add"),{field:t.name()})," ",b()("fas fa-caret-down")])]),m(".Field-body",[m(".Form-group",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.name")),m("input.FormControl",{value:t.name(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"name",t))}),m("span.helpText",o.a.translator.trans("fof-masquerade.admin.fields.name-help"))]),m(".Form-group",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.description")),m("input.FormControl",{value:t.description(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"description",t))}),m("span.helpText",o.a.translator.trans("fof-masquerade.admin.fields.description-help"))]),m(".Form-group",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.icon")),m("input.FormControl",{value:t.icon(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"icon",t))}),m("span.helpText",o.a.translator.trans("fof-masquerade.admin.fields.icon-help",{a:m("a",{href:"https://fontawesome.com/icons?m=free",target:"_blank"})}))]),m(".Form-group",F.a.component({state:t.on_bio(),onchange:this.updateExistingFieldInput.bind(this,"on_bio",t),children:o.a.translator.trans("fof-masquerade.admin.fields.on_bio")})),m(".Form-group",F.a.component({state:t.required(),onchange:this.updateExistingFieldInput.bind(this,"required",t),children:o.a.translator.trans("fof-masquerade.admin.fields.required")})),m(".Form-group",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.type")),x.a.component({onchange:function(n){"null"===n&&(n=null),e.updateExistingFieldInput("type",t,n)},options:this.availableTypes(),value:t.type()})]),"select"===t.type()?B.component({onchange:function(n){e.updateExistingFieldInput("validation",t,n)},value:t.validation()}):null,null===t.type()?m(".Form-group",[m("label",o.a.translator.trans("fof-masquerade.admin.fields.validation")),m("input.FormControl",{value:t.validation(),oninput:m.withAttr("value",this.updateExistingFieldInput.bind(this,"validation",t))}),m("span.helpText",o.a.translator.trans("fof-masquerade.admin.fields.validation-help",{a:m("a",{href:"https://laravel.com/docs/5.2/validation#available-validation-rules",target:"_blank"})}))]):null,m(".Form-group",m(".ButtonGroup",[O.a.component({type:"submit",className:"Button Button--primary",children:o.a.translator.trans("fof-masquerade.admin.buttons."+(n?"edit":"add")+"-field"),loading:this.loading,disabled:!this.readyToAdd(t),onclick:this.updateExistingField.bind(this,t)}),n?O.a.component({type:"submit",className:"Button Button--danger",children:o.a.translator.trans("fof-masquerade.admin.buttons.delete-field"),loading:this.loading,onclick:this.deleteField.bind(this,t)}):null]))])])},n.updateExistingFieldInput=function(t,e,n){var a;e.id()?e.pushAttributes(((a={})[t]=n,a)):e[t](n)},n.updateSort=function(t){var e={sort:t};o.a.request({method:"POST",url:o.a.forum.attribute("apiUrl")+"/masquerade/fields/order",data:e}).then(this.requestSuccess.bind(this))},n.toggleField=function(t){$(t.target).parents(".Field").toggleClass("active")},n.deleteField=function(t){o.a.request({method:"DELETE",url:o.a.forum.attribute("apiUrl")+"/masquerade/fields/"+t.id()}).then(this.requestSuccess.bind(this))},n.submitAddField=function(t){t.preventDefault();var e=this.new;o.a.request({method:"POST",url:o.a.forum.attribute("apiUrl")+"/masquerade/fields",data:e}).then(this.requestSuccess.bind(this)),this.resetNew(),m.redraw()},n.updateExistingField=function(t){if(t.id()){var e=t.data;o.a.request({method:"PATCH",url:o.a.forum.attribute("apiUrl")+"/masquerade/fields/"+t.id(),data:e}).then(this.requestSuccess.bind(this))}},n.requestSuccess=function(t){var e=o.a.store.pushPayload(t);e instanceof Array||!e.deleted_at()||o.a.store.remove(e),this.existing=o.a.store.all("masquerade-field"),this.existing.sort(function(t,e){return t.sort()<e.sort()?-1:t.sort()>e.sort()?1:0}),this.loading=!1,m.redraw()},n.loadExisting=function(){return this.loading=!0,o.a.request({method:"GET",url:o.a.forum.attribute("apiUrl")+"/masquerade/fields"}).then(this.requestSuccess.bind(this))},n.resetNew=function(){this.new={id:m.prop(),name:m.prop(""),description:m.prop(""),prefix:m.prop(""),icon:m.prop(""),required:m.prop(!1),on_bio:m.prop(!1),type:m.prop(null),validation:m.prop("")}},n.readyToAdd=function(t){return!!t.name()},n.availableTypes=function(){return{url:o.a.translator.trans("fof-masquerade.admin.types.url"),email:o.a.translator.trans("fof-masquerade.admin.types.email"),boolean:o.a.translator.trans("fof-masquerade.admin.types.boolean"),select:o.a.translator.trans("fof-masquerade.admin.types.select"),null:o.a.translator.trans("fof-masquerade.admin.types.advanced")}},e}(v.a),j=function(){app.routes["fof-masquerade-configure-profile"]={path:"/fof/masquerade/configure",component:E.component()},app.extensionSettings["fof-masquerade"]=function(){return m.route(app.route("fof-masquerade-configure-profile"))},Object(a.extend)(l.a.prototype,"items",function(t){t.add("fof-masquerade-configure-profile",f.a.component({href:app.route("fof-masquerade-configure-profile"),icon:"far fa-id-card",children:"Masquerade",description:app.translator.trans("fof-masquerade.admin.menu.description")}))})};o.a.initializers.add("fof-masquerade",function(t){t.store.models["masquerade-field"]=u.a,Object(a.extend)(s.a.prototype,"viewItems",function(e){e.add("masquerade-view-profile",{icon:"far fa-id-card",label:t.translator.trans("fof-masquerade.admin.permissions.view-profile"),permission:"fof.masquerade.view-profile",allowGuest:!0})}),Object(a.extend)(s.a.prototype,"startItems",function(e){e.add("masquerade-have-profile",{icon:"far fa-id-card",label:t.translator.trans("fof-masquerade.admin.permissions.have-profile"),permission:"fof.masquerade.have-profile"})}),j()})}]);
//# sourceMappingURL=admin.js.map